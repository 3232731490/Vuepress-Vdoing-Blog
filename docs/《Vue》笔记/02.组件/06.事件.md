---
title: 事件
date: 2021-09-27 06:50:11
permalink: /pages/98b97d/
categories:
  - 《Vue》笔记
  - 组件
tags:
  - Vue
  - 笔记
author:
  name: nilu
  link: https://github.com/3232731490
---

## 组件的自定义事件

1. 一种组件间通信的方式，适用于：`子组件===>父组件`

2. 使用场景：子组件想给父组件传递数据时

3. 绑定自定义事件

   1. 第一种方式：`<Demo @nilu='getStuName'/>`

   2. 第二种方式：

      ```vue
        <Student ref='student'/>   
        ...
        mounted(){
          this.$refs.student.$on('nilu',this.getStuName)
        }
      ```

   3. 如果只想让自定义事件触发一次，可以使用once修饰符或$once方法

4. 触发自定义事件：`this.$emit('Demo',数据)`

5. 解绑自定义事件：`this.$off('Demo')

6. 组件上若要绑定原生DOM事件，需要使用native修饰符

   ```html
     <Student ref='student' @click.native='show'/>
   ```

7. 注意：通过`this.$refs.student.$on('nilu',回调)`绑定自定义事件时，回调要么定义在methods中，要么使用箭头函数，否则this指向将出问题 ***(Vue规定谁触发事件，回调函数中的this就是谁，所以此处需要写箭头函数，this才会指向当前App，如果写成普通函数，则this指向student对象)***

## 全局事件总线

1. 一种组件间通信的方式，适用于任意组件间通信
2. 安装全局事件总线

  ```
  new Vue({
    ...
    // 安装全局事件总线
    beforeCreate(){
      Vue.prototype.$bus=this
    }
  })
  ```

3. 使用事件总线

   1. 接收数据：A组件想接收数据，则A组件中给$bus绑定自定义事件，事件的**回调留在A组件自身**

      ```
      mounted(){
        this.$bus.$on('xxx',回调函数)
      },
      ```

   2. 提供数据：`this.$bus.$emit('xxx',数据)`

4. 最好在beforeDestroy钩子中，使用$off解绑**当前组件**用到的事件

## 消息订阅与发布

1. 一种组件间通信的方式，适用于任意组件间通信

2. 使用步骤

   1. 安装pubsub : `npm i pubsub-js`

   2. 引入： `import pubsub from 'pubsub-js'`

   3. 接收数据：A组件想接收数据，则在A组件中订阅消息，订阅的回调留在A自身

      ```
        // 消息订阅
        mounted(){
          // 如果回调函数写正常函数，则函数内的this为undefined
            this.pubid = pubsub.subscribe('test',(_,data)=>{
              console.log("School....",data)
            })
        },
      ```

      **或者**

      ```
        methods:{
          demo(){...}
        },
        mounted(){
          this.pubid = pubsub.subscribe('test',this.demo)
        }
      ```

    4. 提供数据 `pubsub.publish('test',数据)`

    5. 最好在beforeDestroy钩子中，使用`pubsub.unsubscribe(this.pubid)`取消订阅