---
title: Vuex
date: 2021-09-27 06:57:39
permalink: /pages/52fae1/
categories:
  - 《Vue》笔记
  - 进阶
tags:
  - Vue
  - 笔记
author:
  name: nilu
  link: https://github.com/3232731490
---

## Vuex

### 1. 概念

#### ①. Vuex是什么？

Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。

#### ②. 原理图

![](https://vuex.vuejs.org/vuex.png)

### 2. 搭建环境

1. 创建文件/store/index.js

```javascript
// 该文件用于创建vuex最为核心的store
// 引入Vuex
import Vuex from 'vuex'
// 引入Vue
import Vue from 'vue'
// 使用vuex
Vue.use(Vuex)
// 准备actions，用于响应组件中的动作
const actions={}

// 准备mutations，用于操作数据
const mutations={}

// 准备state，用于存储数据
const state={}

// 创建并暴露store
export default new Vuex.Store({
    actions,
    mutations,
    state
})
```

2. 引入store

```javascript
    // 引入store
    import store from './store'
    // 创建Vue
    new Vue({
        el:"#app",
        render:h=>h(App),
        store,
        beforeCreate(){
            Vue.prototype.$bus=this
        }
    })
```

3. 组件中读取vuex中的数据：`$store.state.key`
4. 组件中修改vuex中的数据：`$store.dispatch('action中的方法',数据)`或`$store.commit('mutations中的方法',数据)`

### 3. Vuex求和案例

#### ①. 传统vue代码

```vue
    <template>
        <div>
            <h1>当前求和为： {{sum}}</h1>
            <select v-model.number='num'>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
            <button @click="add"> +</button>
            <button @click="sub">-</button>
            <button @click="odd">当前求和为奇数再加</button>
            <button @click="waitadd">等一等再加</button>
        </div>
    </template>

    <script>
        export default {
            name:'Count',
            data(){
                return {
                    sum:0,   // 求和
                    num:1    // 用户所选
                }
            },
            methods:{
                add(){
                    this.sum+=this.num;
                },
                    sub(){
                        this.sum-=this.num;
                    },
                    odd(){
                        this.sum+=this.sum%2==0?0:this.num;
                    },
                    waitadd(){
                        setTimeout(()=>{
                            this.sum+=this.num;
                        },500)
                    }
            }
        }
    </script>

```

#### ②. Vuex实现

1. 组件代码

```vue
<template>
  <div>
      <h1>当前求和为： {{$store.state.sum}}</h1>
      <select v-model.number='num'>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
      </select>
      <button @click="add"> +</button>
      <button @click="sub">-</button>
  </div>
</template>

<script>
export default {
    name:'Count',
    data(){
        return {
            num:1    // 用户所选
        }
    },
   methods:{
       add(){
           // 如果没有额外逻辑直接调用commit直接取mutations打交道即可
           this.$store.commit('INC',this.num)
       },
        sub(){
            this.$store.dispatch('dec',this.num)
        },
   }
}
</script>

<style>
    button{
        margin-left:5px;
    }
</style>
```

2. Store代码

```javascript
// 该文件用于创建vuex最为核心的store
// 引入Vuex
import Vuex from 'vuex'
// 引入Vue
import Vue from 'vue'
// 使用vuex
Vue.use(Vuex)
// 准备actions，用于响应组件中的动作
const actions={
    inc(context,value){
        context.commit('INC',value)
    },
    dec(context,value){
        context.commit('DEC',value)
    }
}
// 准备mutations，用于操作数据
const mutations={
    INC(state,value){
        state.sum+=value
    },
    DEC(state,value){
        state.sum-=value
    },
}
// 准备state，用于存储数据
const state={sum:0}

// 创建并暴露store
export default new Vuex.Store({
    actions,
    mutations,
    state
})

```

### 3. getters的使用

1. 概念：当state中的数据需要加工时使用，可以使用getters加工

2. 在store.js中追加getters配置

   ```javascript
       // 准备getters，用于将state中的数据进行加工
       const getters={
           bigSum(state){
               return state.sum * 10
           }
       }
       export default new Vuex.Store({
           ......
           getters
       })
   
   ```

3. 组件中读取：`$store.getters.bigSum`

### 4. 四个map方法的使用

1. **mapState方法：**用于帮助我们映射`state`中的数据为计算属性

   ```javascript
       computed:{
           // 自动帮你把state的属性用计算属性弄出来
           ...mapState({sum:'sum',school:'school',addr:'addr'})
           // 使用数组简写 要求计算属性名与state中属性名一致
           ...mapState(['sum','school','addr']),
       },
   ```

2. **mapGetters：**用于帮助我们映射getters中的数据为计算属性

   ```javascript
       computed:{
       // 自动帮你把state的属性用计算属性弄出来
       ...mapGetters({bigSum:'bigSum'})
       // 使用数组简写
       ...mapGetters(['bigSum'])
       },
   ```

3. **mapMutations：**用于帮助我们映射`mutations`中的方法

   ```javascript
       methods:{
          // 借助mapMutations生成对应方法
          ...mapMutations({add:'INC',sub:'DEC'}),
          // 使用数组简写
          ...mapMutations(['INC','DEC']),
      }    
   ```

4. **mapActions:** 用于帮助我们映射`actions`中的方法

   ```javascript
       methods:{
          // 借助mapMutations生成对应方法
          ...mapActions({odd:'oddinc',waitadd:'waitinc'})
          // 使用数组简写
          ...mapActions(['oddinc','waitinc']),
      }    
   ```

### 5. Vuex模块化命名空间

1. 目的：让代码更好维护，让多种数据分类更明确
2. 修改`store.js`

```javascript
const countOptions = {
    namespaced:true,
    actions:{
        ...
    },
    state:{
       ...
    },
    getters:{
       ...
    },
    mutations:{
        ...
    }
}

// 人员相关的配置
const personOptions = {
    namespaced:true,
    actions:{
        ...
    },
    state:{
        ...
    },
    getters:{
        ...
    },
    mutations:{
        ...
    }
}
// 创建并暴露store
export default new Vuex.Store({
    modules:{
        countOptions,
        personOptions
    }
})
```

3. 开启命名空间后，组件中读取state数据

```JavaScript
// 方式一：自己直接读取
this.$store.state.personOptions.persons
// 方式二：借助mapState读取
...mapState('countOptions',['sum','school','addr']),
```

4. 开启命名空间后，组件中读取geeter数据

```JavaScript
// 方式一：自己直接读取
this.$store.getters['personOptions/fisrtPersonName']
// 方式二：借助mapGetters读取
...mapGetters('countOptions',['bigSum'])
```

5. 开启命名空间后，组件中调用dispatch

```JavaScript
// 方式一：自己直接dispatch
this.$store.dispatch('personOptions/addPersonNi',person)
// 方式二：借助mapActions
...mapActions('countOptions',{odd:'oddinc',waitadd:'waitinc'})
```

6. 开启命名空间后，组件中调用commit

```JavaScript
// 方式一：自己直接commit
this.$store.commit('personOptions/ADD_PERSON',person)
// 方式二：借助mapMutations读取
...mapMutations('countOptions',{add:'INC',sub:'DEC'}),
```