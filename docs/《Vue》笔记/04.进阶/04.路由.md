---
title: 路由
date: 2021-09-27 06:58:35
permalink: /pages/365141/
categories:
  - 《Vue》笔记
  - 进阶
tags:
  - Vue
author:
  name: nilu
  link: https://github.com/3232731490
---

## 路由

### 1. 基本使用

      1. 安装vue-router： `npm i vue-router`
      2. 应用插件：`Vue.use(VueRouter)`
      3. 编写router配置项

```javascript
// 该文件专门用于创建整个应用的路由器
import VueRouter from 'vue-router'
// 引入组件
import About from '../components/About'
import Home from '../components/Home'
// 创建一个路由器并暴露
export default new VueRouter({
    routes:[
        {
            path:'/about',
            component:About
        },
        {
            path:'/home',
            component:Home
        },
    ]
})
```

      4. 实现切换`active-class用于设置高亮样式`

```html
<router-link class="list-group-item" active-class="active" to='./about'>About</router-link>
```

      5. 指定展示位置

```html
<router-view></router-view>
```

### 2. 几个注意点

      1. 路由组件通常存放在pages文件夹中，一般组件通常存放在components文件夹
      2. 通过切换，隐藏了的路由组件，默认是被销毁掉的，需要的时候再去挂载
      3. 每个组件都有自己的`$route`属性，里面存储着自己的路由信息
      4. 整个应用只有一个router，可以通过组件的`$router`属性获取

### 3. 多级路由

      1. 配置路由规则，使用children配置项

```javascript
routes:[
    {
        path:'/about',
        component:About
    },
    {
        path:'/home',
        component:Home,
        children:[
            {path:'News',component:News},
            {path:'Message',component:Message},
        ]
    },
]
```

      2. 跳转(要写完整路径)

```javascript
<router-link class="list-group-item" active-class="active" to='/Home/Message'>Message</router-link>
```

### 4. 路由的query参数

1. 传递参数

```html
    <!--跳转路由并携带query参数，to的字符串写法-->
    <router-link :to='`/home/Message/Detail?id=${m.id}&title=${m.title}`'>{{m.title}}</router-link>
    <!--跳转路由并携带query参数，to的对象写法-->
    <router-link :to="{
      path:'/home/Message/Detail',
      query:{
        id:m.id,
        title:m.title
      }
    }">
    {{m.title}}</router-link>
```

2. 接收参数

```html
    $route.query.id
    $route.query.title
```

### 5. 给路由命名

1. 作用： 可以简化路由的跳转

2. 如何使用

   1. 给路由命名：

    ```JavaScript
   routes:[
       {
           path:'/home',
           component:Home,
           children:[
               {path:'News',component:News},
               {
                   path:'Message',component:Message,
                   children:[
                       {
                           path:'Detail',component:Detail,
                           name:"xijie"    // 给路由命名
                       }
                   ]
               },
           ]
       },
   ]
    ```

     2. 简化跳转

    ```vue
   <router-link :to="{
       // 简化前要写完整的路径
       path:'/home/Message/Detail',
       // 简化后通过名字跳转
       name:'xijie',
       query:{
         id:m.id,
         title:m.title
       }
   }">
   {{m.title}}</router-link>
    ```

### 6. 路由的params参数

1. 配置路由，声明接收params参数

```JavaScript
    {
        path:'/home',
        component:Home,
        children:[
            {path:'News',component:News},
            {
                path:'Message',component:Message,
                children:[
                    {
                        path:'Detail/:id/:title',   // 使用占位符声明接收params参数
                        component:Detail,
                        name:"xijie"
                    }
                ]
            },
        ]
    }
```

2. 传递参数

```html
    <!--跳转路由并携带param参数，to的字符串写法-->
    <router-link :to='`/home/Message/Detail/${m.id}/${m.title}`'>{{m.title}}</router-link>
    <!--跳转路由并携带params参数，to的对象写法-->
    <router-link :to="{
      path:'/home/Message/Detail',  不可写path参数，只能使用name
      name:'xijie',
      params:{
        id:m.id,
        title:m.title
      }
    }">
    {{m.title}}</router-link>
```

> 特别注意：路由携带params参数是，若使用to的对象写法，则不能使用path配置项，必须使用name配置！ 

3. 使用参数

```html
    $route.params.id
    {$route.params.title
```

### 7. 路由的props配置

    作用： 让路由组件更方便的收到参数

```JavaScript
{
    path:'Detail',component:Detail,
    name:"xijie",
    // props的第一种写法,该对象中的所有key-value都会以props的形式传个detail组件
    props:{
        a:1,b:'hello'
    }
    // props的第二种写法，若为真，则会把路由组件收到的所有params参数，以proDetail组件
    props:true
    // props的第三种写法，值为函数,返回值的所有key-value都会以props的形式传个\给组件
    props($route){
        return {id:$route.query.id,title:$route.query.title}
    }
}
```

### 8. `<router-link>`的replace属性

      1. 作用：控制路由跳转时操作浏览器历史记录的模式
      2. 浏览器的历史记录有两种写入方式，分别为`push`和`replace`，`push`时追加历史记录，`replace`是替换当前记录。路由跳转时默认为`push`
      3. 如何开启`replace`模式：`<router-link replace .....></router-link>`

### 9. 编程式路由导航

1. 作用： 不借助`<router-link>`实现路由跳转，让路由跳转更加灵活

2. 具体编码

   ```JavaScript
       this.$router.push({
           name:'xijie',
           query:{
               id:m.id,
               title:m.title
           }
       })
   
       this.$router.replace({
           name:'xijie',
           query:{
               id:m.id,
               title:m.title
           }
       })
   
       back(){
           this.$router.back() // 页面后退
       },
       forward(){  
           this.$router.forward()  // 页面前进
       },
       go(){
           this.$router.go(-2);    // 往后退两步
           this.$router.go(2);    // 前进两步
       }
   ```

### 10. 缓存路由组件

1. 作用： 让不展示的路由组件保持挂载，不被销毁

2. 具体编码

   ```html
       <!--include配置项写明要保存缓存的组件名-->
       <keep-alive include="News">
           <router-view></router-view>      
       </keep-alive>
       <!--缓存多个路由组件-->
       <keep-alive :include='["News","Message"]'>
           <router-view></router-view>      
       </keep-alive>
   ```

### 11. 两个新的生命周期钩子

      1. 作用： 路由组件所独有的两个钩子，用于捕获路由组件的激活状态
      2. 具体名字
         1.  `activated`路由组件被激活时触发
         2.  `deactivated`路由组件失活时触发

### 12. 路由守卫

1. 作用：对路由进行权限控制

2. 分类：全局守卫，独享守卫，组件内守卫

   1. 全局守卫

    ```JavaScript
    // 全局前置路由守卫---初始化时被调用，每次路由切换之前被调用
    router.beforeEach((to,from,next)=>{
        if(to.meta.isAuth)  // 判断当前路由是否需要权限控制
            if(localStorage.getItem('name')==='nilu')   // 权限控制的具体规则
                next()  // 放行
            else
                alert('对不起，您无权查看')
        else
            next()
    })
   
    // 全局后置路由守卫---初始化时被调用，每次路由切换之后被调用
    router.afterEach((to,from)=>{
        document.title=to.meta.title    // 修改网页的title
    })
    ```

   2. 独享守卫

    ```JavaScript
    // 独享守卫,只服务于某一个路由
   beforeEnter:(to,from,next)=>{
       if(to.meta.isAuth)
           if(localStorage.getItem('name')==='nilu')
               next()
           else
               alert('对不起，您无权查看')
       else
           next()
   }
    ```

     3. 组件内守卫

    ```JavaScript
    // 通过路由规则，进入该组件时被调用
   beforeRouteEnter (to, from, next) {
   },
   // 通过路由规则，离开该组件被调用
   beforeRouteLeave (to, from, next) {
   }
    ```

### 13. 路由器的两种工作模式

1. 对于一个url来说，什么是`hash`值？——#以及后面的内容就是hash值
   如http://localhost:8080/myWeb<span style='color:red'>/#/a/b/c/d/e</span>
2. hash值不会包含在HTTP请求中，即：hash值不会带给服务器
3. hash模式
   1. 地址中永远带着#号，不美观
   2. 若以后将地址通过第三方手机app分享，若app校验严格，则地址会被标记为不合法
   3. 兼容性较好
4. history模式
   1. 地址干净，美观
   2. 兼容性和hash模式相比略差
   3. 应用部署上线时需要后端人员支持，解决刷新页面服务端404的问题