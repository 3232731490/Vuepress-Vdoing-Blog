---
title: 第一个hibernate程序
date: 2021-09-28 11:47:17
permalink: /pages/63edff/
categories:
  - 《Hibernate》学习笔记
  - 基础
tags:
  - Hibernate
  - 笔记
---

## 第一个hibernate程序

### 构建项目

1. 创建maven工程

2. 引入依赖

   ```xml
     <dependencies>
       <dependency>
         <groupId>org.hibernate</groupId>
         <artifactId>hibernate-core</artifactId>
         <version>5.5.7.Final</version>
       </dependency>
       <dependency>
         <groupId>mysql</groupId>
         <artifactId>mysql-connector-java</artifactId>
         <version>8.0.23</version>
       </dependency>
     </dependencies>
   ```

3. 引入hibernate配置文件

   1. 点击`Project Structure`
   2. 选择`facets`,点击左上方加号，选择`hibernate`,选择当前项目
   3. 点击右上方加号，添加`hibernate.cfg.xml`文件即可



### 配置文件

```xml
<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE hibernate-configuration PUBLIC
    "-//Hibernate/Hibernate Configuration DTD//EN"
    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd">
<hibernate-configuration>
  <session-factory>
    <!--配置连接数据库的基本信息-->
    <property name="connection.url">jdbc:mysql://localhost:3306/springboot_vue</property>
    <property name="connection.driver_class">com.mysql.cj.jdbc.Driver</property>
    <property name="connection.username">root</property>
    <property name="connection.password">20021112nl</property>

    <!--配置hiber的基本信息-->
    <property name="dialect">org.hibernate.dialect.MySQL8Dialect</property>

    <!--执行操作时是否在控制台打印sql-->
    <property name="show_sql">true</property>

    <!--是否对SQL进行格式化-->
    <property name="format_sql">true</property>

    <!--指定自动生成数据表的策略-->
    <property name="hibernate.hbm2ddl.auto">update</property> 
  </session-factory>
</hibernate-configuration>
```



### 映射文件自动生成

[教程链接]([(8条消息) IntelliJ IDEA下自动生成Hibernate映射文件以及实体类_sam199510的博客-CSDN博客_idea生成hibernate实体](https://blog.csdn.net/qq_34197553/article/details/77718925))

**生成结果如下**

1. 实体类

   > 由于篇幅原因，仅保留函数声明

   ```java
   -java
     - com
      - entity
       - UserEntity
   package com.nilu.entity;
   
   import javax.persistence.*;
   
   /**
    * @author: 倪路
    * Time: 2021/9/28-11:10
    * StuNo: 1910400731
    * Class: 19104221
    * Description:
    */
   @Entity
   @Table(name = "user", schema = "springboot_vue", catalog = "")
   public class UserEntity {
       private int id;
       private String username;
       private String password;
       private String nickname;
       private Integer age;
       private String sex;
       private String address;
   
       @Id
       @Column(name = "id")
       public int getId() {}
   
       public void setId(int id) {}
   
       @Basic
       @Column(name = "username")
       public String getUsername() {}
   
       public void setUsername(String username) {}
   
       @Basic
       @Column(name = "password")
       public String getPassword() {}
   
       public void setPassword(String password) {}
   
       @Basic
       @Column(name = "nickname")
       public String getNickname() {}
   
       public void setNickname(String nickname) {}
   
       @Basic
       @Column(name = "age")
       public Integer getAge() {}
   
       public void setAge(Integer age) {}
   
       @Basic
       @Column(name = "sex")
       public String getSex() {}
   
       public void setSex(String sex) {}
   
       @Basic
       @Column(name = "address")
       public String getAddress() { }
   
       public void setAddress(String address) {}
   
       @Override
       public boolean equals(Object o) {}
   
       @Override
       public int hashCode() {}
   }
   
   ```

   

2. 映射文件

   ```xml
   -resources
    -UserEntity.hbm.xml
   
   <?xml version='1.0' encoding='utf-8'?>
   <!DOCTYPE hibernate-mapping PUBLIC
       "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
       "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
   <hibernate-mapping>
   
       <class name="com.nilu.entity.UserEntity" table="user" schema="springboot_vue">
           <id name="id" column="id"/>
           <property name="username" column="username"/>
           <property name="password" column="password"/>
           <property name="nickname" column="nickname"/>
           <property name="age" column="age"/>
           <property name="sex" column="sex"/>
           <property name="address" column="address"/>
       </class>
   </hibernate-mapping>
   ```

   

3. 配置文件

   ```xml
   -resources
    -hibernate.cfg.xml
   新增
   <mapping resource="UserEntity.hbm.xml"/>
   <mapping class="com.nilu.entity.UserEntity"/>
   ```



### 基本使用

```java
@Test
public void TestHelloWorld(){
    // 1. 创建一个SessionFactory对象
    SessionFactory sessionFactory = null;
    // 1) 创建Configuration对象：对应hibernate基本配置信息和对象关系映射信息
        // configure() 默认导入hibernate.cfg.xml 配置文件
    Configuration configuration = new Configuration().configure();
    sessionFactory = configuration.buildSessionFactory();
    // 2. 创建Session对象
    Session session = sessionFactory.openSession();
    // 3. 开启事务
    Transaction transaction = session.beginTransaction();
    // 4. 执行保存操作
    UserEntity user = new UserEntity(14,"nilu","20021112","xiaolu",19,"男","shanghai");
    session.save(user);
    // 5. 提交事务
    transaction.commit();
    // 6. 关闭Session
    session.close();
    // 7、 关闭Session Factory
    sessionFactory.close();
}
```

### 重要配置项

1. Configuration类用于管理Hibernate的基本配置信息，包括hibernate运行的底层信息，数据库Dialect，数据库连接池等（对应hibernate.cfg.xml文件），以及持久化类与数据表的映射关系（*.hbm.xml文件）

2. 创建Configuration两种方式

   + 属性文件（hibernate.properties）
     + `Configuration cfg = new Configuration();`

   + XML文件
     + `Configuration cfg = new Configuration().configure();`

   + Configuration的configure方法携带参数
     + `File file = new FIle('example.xml');`
     + `Configuration cfg = new Configuration().configure(file);`

3. SessionFactory接口
   + 生成Session的工厂

4. Session
   + 是应用程序域数据库之间的交互操作的一个**单线程对象**
   + 相当于JDBC中的Connection

5. `Hibernate`的两个配置项

   + `hbm2ddl.auto`
     + create：根据.hbm.xml文件生成数据表，但是每次运行都会删除原表创建一个新的表
     + create-drop：根据.hbm.xml文件生成数据表，但是SessionFactory一旦关闭，表就会自动删除
     + **update**： 最常用的属性，根据.hbm.xml文件生成数据表，但它只是更新表的结构，对于已有的行和列将会保留
     + validate：回合数据库中的表进行比较，若.hbm.xml文件中的列在数据库表中不存在，则抛出异常

   + `format-sql`: 是否对SQL进行格式化

